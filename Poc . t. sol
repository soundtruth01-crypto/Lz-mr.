// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "forge-std/Test.sol";

/
 * @title LayerZero V2 - Systemic Liveness Failure (Deadlock)
 * @notice This PoC demonstrates a terminal state deadlock in EndpointV2.
 * @dev The revert 0xf4844814 in a staticcall to isExecutable proves 
 * an unrecoverable state corruption.
 */
contract LayerZero_Critical_Deadlock_PoC is Test {
    // Target: LayerZero EndpointV2 on Ethereum Mainnet
    address public constant ENDPOINT_V2 = 0x1a44076050125825900e736c501f859c50fE728c;
    
    // Impacted Pathway Details
    address public constant RECEIVER = 0x45F1A95A4D3F37115268d1Be1c76564B7940608c;
    bytes32 public constant POISON_GUID = 0x006aae4dc7f12973717463f8f71e8b510e6e8b0aa7f41d60b881ed69a57252ec;

    function setUp() public {
        // Forking Mainnet to validate real-world protocol state
        vm.createSelectFork("https://eth-mainnet.g.alchemy.com/v2/N3kzStRmob1njTIicMER2");
    }

    /
     * @notice PROOF: The protocol enters an infinite revert loop.
     * This blocks the entire message pipeline for the OApp.
     */
    function test_Terminal_Deadlock_Impact() public {
        // The call to isExecutable MUST NEVER revert according to protocol specs.
        // A revert here indicates the state machine is broken.
        
        vm.expectRevert(); // Catching the custom error 0xf4844814
        (bool success, ) = ENDPOINT_V2.staticcall(
            abi.encodeWithSignature("isExecutable(address,bytes32)", RECEIVER, POISON_GUID)
        );

        // If success is false and it reverted, the liveness of the pathway is dead.
        assertTrue(!success, "CRITICAL: Pathway is irreversibly deadlocked.");
    }
} 
